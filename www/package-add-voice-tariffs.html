<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Add SIM Based Voice/SMS - Self Care Hosting Portal</title>
        <meta name="format-detection" content="telephone=no" />
        <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />-->
        <meta name="viewport" content="width=320, initial-scale=1" />
        <link rel="stylesheet" href="js/jquery-mobile/jquery.mobile.css" />
        <link rel="stylesheet" href="css/common.css" />
        <link rel="stylesheet" type="text/css" href="css/sweet-alert.css">
        <script type="text/javascript" src="js/sweet-alert.js"></script>
        <script src="js/jquery/jquery.js"></script>
        <script src="js/jquery-mobile/jquery.mobile.js"></script>
        <script src="js/class.logbucket.js"></script>
        <script src="js/class.user.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/my_linphone.js"></script>
    </head>
    <body onunload="">
        <div data-role="page">
            <!-- START: Title -->
            <div data-role="header">
                <a href="package-add.html" data-icon="back" rel="external" class="button_back">Back</a>
                <a href="index.html" data-icon="home" rel="external" data-theme="b">Home</a>
                <h1 id="title">Add SIM Based Voice/SMS</h1>
            </div>
            <!-- END: Title -->
            <!-- START: Content -->
            <div data-role="content">
                <!-- START: Message Board -->
                <div id="message"></div>
                <!-- END: Message Board -->
                <button id="make_payment" type="submit" onclick="window.location.href='payment-create.html';" data-theme="e">
                    Make Payment
                </button>  
                <div data-role="fieldcontain">
                    <label for="select_tariffs">Tariffs:</label>
                    <select name="select_tariffs" id="select_tariffs" onchange="show_tariffs(this.value);">
                        <option value="" selected="selected">- Select -</option>
                        <option value="psb">Per Second Billing</option>
                        <option value="pmb">Per Minute Billing</option>
                        <option value="cc">Calling Circles</option>
                        <option value="cug">Closed User Groups</option>
                    </select>
                </div>
                <!-- START: PSB -->
                <h2 id="psb_table_title">Per Second Billing</h2>
                <table width="100%" id="psb_table" data-role="table" data-mode="reflow" class="ui-responsive table-stroke table-stripe">
                    <thead>
                        <tr>
                            <th style="text-align: left;" id="plan_column">
                                Plan
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OnNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OffNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                SMS
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;" id="charge_column">
                                Access Charge
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                &nbsp;
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5"><img src="img/ajax-load-black.gif"> Loading data</td>
                        </tr>
                    </tbody>
                </table>
                <!-- END: PSB -->

                <!-- START: PMB -->
                <h2 id="pmb_table_title">Per Minute Billing</h2>
                <table width="100%" id="pmb_table" data-role="table" data-mode="reflow" class="ui-responsive table-stroke table-stripe">
                    <thead>
                        <tr>
                            <th style="text-align: left;" id="plan_column">
                                Plan
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OnNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OffNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                SMS
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;" id="charge_column">
                                Access Charge
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                &nbsp;
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5"><img src="img/ajax-load-black.gif"> Loading data</td>
                        </tr>
                    </tbody>
                </table>
                <!-- END: PMB -->

                <!-- START: CC -->
                <h2 id="cc_table_title">Calling Circles</h2>
                <table width="100%" id="cc_table" data-role="table" data-mode="reflow" class="ui-responsive table-stroke table-stripe">
                    <thead>
                        <tr>
                            <th style="text-align: left;" id="plan_column">
                                Plan
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OnNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OffNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                SMS
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;" id="charge_column">
                                Monthly Charge
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                &nbsp;
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5"><img src="img/ajax-load-black.gif"> Loading data</td>
                        </tr>
                    </tbody>
                </table>
                <!-- END: CC -->

                <!-- START: CUG -->
                <h2 id="cug_table_title">Closed User Groups</h2>
                <table width="100%" id="cug_table" data-role="table" data-mode="reflow" class="ui-responsive table-stroke table-stripe">
                    <thead>
                        <tr>
                            <th style="text-align: left;" id="plan_column">
                                Plan
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OnNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                OffNet
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                SMS
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;" id="charge_column">
                                Daily Charge
                            </th>
                            <th style="font-size: 12px;text-align:center;width:40px;">
                                &nbsp;
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="6"><img src="img/ajax-load-black.gif"> Loading data</td>
                        </tr>
                    </tbody>
                </table>
                <!-- END: CUG -->
            </div>
            <!-- END: Content -->
        </div>

        <script type="text/javascript">
                        app.initialize();
                        if (global.get('auth') === null) {
                            window.location.href = 'login.html';
                        }
                        balance_display_in_button();  
                        function tariffs_display(result) {
                            var tariffs = result.details;
                            var psb_rows = '';
                            var pmb_rows = '';
                            var cc_rows = '';
                            var cug_rows = '';
                            for (var i = 0; i < tariffs.length; i++) {
                                var tariff = tariffs[i];
                                var row = '<tr>';
                                row += '<td style="font-weight:bold;color:blue;">' + tariff["product"] + '</td>';
                                row += '<td>' + tariff["onnet_tariff"] + '</td>';
                                row += '<td>' + tariff["offnet_tariff"] + '</td>';
                                row += '<td>' + tariff["offnet_tariff"] + '</td>';
                                row += '<td>' + tariff["access_charge"] + '</td>';
                                row += '<td><a href="#" data-role="button" data-mini="true" data-inline="true" data-theme="b" data-icon="plus" onclick="package_add(\'' + tariff["product"] + '\');return false;">Add Package</a></td>';
                                row += '</tr>';
                                if (tariff['product'].indexOf('(CC)') > -1) {
                                    cc_rows += row;
                                } else if (tariff['product'].indexOf('(CUG)') > -1) {
                                    cug_rows += row;
                                } else if (tariff['billing_type'] === 'PSB') {
                                    psb_rows += row;
                                } else if (tariff['billing_type'] === 'PMB') {
                                    pmb_rows += row;
                                }

                            }
                            if (cc_rows === '' && cug_rows ==='' && psb_rows === '' && pmb_rows === '') {
                                var row = '<tr>';
                                row += '<td colspan="6">No packages found</td>';
                                row += '</tr>';
                                tariffs_rows += row;
                            }
                            $('#psb_table tbody').html(psb_rows);
                            $('#pmb_table tbody').html(pmb_rows);
                            $('#cc_table tbody').html(cc_rows);
                            $('#cug_table tbody').html(cug_rows);
                            $('#psb_table').table('refresh');
                            $('#pmb_table').table('refresh');
                            $('#cc_table').table('refresh');
                            $('#cug_table').table('refresh');

                            try {
                                $('#psb_table a').button().button('refresh');
                            } catch (e) {

                            }
                            try {
                                $('#pmb_table a').button().button('refresh');
                            } catch (e) {

                            }
                            try {
                                $('#cc_table a').button().button('refresh');
                            } catch (e) {

                            }
                            try {
                                $('#cug_table a').button().button('refresh');
                            } catch (e) {

                            }
                        }

                        function show_tariffs(type) {
                            $('#psb_table').hide();
                            $('#pmb_table').hide();
                            $('#cc_table').hide();
                            $('#cug_table').hide();
                            $('#psb_table_title').hide();
                            $('#pmb_table_title').hide();
                            $('#cc_table_title').hide();
                            $('#cug_table_title').hide();
                            if (type === 'psb') {
                                $('#psb_table').show();
                                $('#psb_table_title').show();
                            }
                            if (type === 'pmb') {
                                $('#pmb_table').show();
                                $('#pmb_table_title').show();
                            }
                            if (type === 'cc') {
                                $('#cc_table').show();
                                $('#cc_table_title').show();
                            }
                            if (type === 'cug') {
                                $('#cug_table').show();
                                $('#cug_table_title').show();
                            }
                        }

                        function package_add(package) {
                            var user_id = global.getUser().getId();
                            var data = {user_id: user_id, package: package};
                            global.api('package_add', data, function(response) {
                                if (response.details === false) {
                                    var msg = "<span style='color:red;'>The package COULD NOT be added</span>";
                                    $('#message').html(msg);
                                    return;
                                }
                                $('#message').html(response.details);
                            });
                        }

                        $(document).delegate('body', 'pageinit', function() {
                            $('#psb_table').hide();
                            $('#pmb_table').hide();
                            $('#cc_table').hide();
                            $('#cug_table').hide();
                            $('#psb_table_title').hide();
                            $('#pmb_table_title').hide();
                            $('#cc_table_title').hide();
                            $('#cug_table_title').hide();
                            var user = global.getUser();
                            var user_id = user.getId();
                            var data = {user_id: user_id};
                            global.api('packages_voice_tariffs', data, tariffs_display);
                        });
        </script>
    </body>
</html>
